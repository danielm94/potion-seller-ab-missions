on_battle_won_country = {
	if = {
		limit = {
			has_government_mechanic = wallachian_terror_mechanic
			has_country_modifier = wallachian_terror_brutalize_the_enemy
		}
		set_variable = {
			which = land_units_killed_var
			which = land_units_lost
		}
		divide_variable = {
			which = land_units_killed_var
			value = 6666.666			#that's not on purpose lol
		}
		change_terror_var = {
			var = land_units_killed_var
			scaled_with_gain_modifier = yes
		}
	}
}

on_battle_lost_province = {
	FROM = {
		save_global_event_target_as = battle_winner
	}
	if = {
		limit = {
			FROM = {
				has_government_mechanic = wallachian_terror_mechanic
				has_country_modifier = wallachian_terror_brutalize_the_enemy
			}
		}
		if = {
			limit = {
				owner = {
					war_with = event_target:battle_winner
				}
			}
			apply_wallachian_terror_battle_won_enemy_province_modifier = yes
			apply_wallachian_terror_battle_won_owner_penalty = yes
		}
		else_if = {
			limit = {
				owned_by = event_target:battle_winner
			}
			apply_wallachian_terror_battle_won_own_province_modifier = yes
		}
	}
}

on_bi_yearly_pulse = {
	every_country = {
		limit = {
			is_wallachian_terror_dynamic_country_color_enabled = yes
		}
		change_color_based_on_terror = yes
	}
}

#ROOT = winner country
#FROM = location
on_siege_won_country = {
	if = {
		limit = {
			has_government_mechanic = wallachian_terror_mechanic
		}
		save_global_event_target_as = impaler_country
		if = {
			limit = {
				FROM = {
					owner = {
						war_with = event_target:impaler_country
						OR = {
							is_in_war = {
								attacker_leader = THIS
								defender_leader = event_target:impaler_country
							}
							is_in_war = {
								attacker_leader = event_target:impaler_country
								defender_leader = THIS
							}
						}
					}
					is_capital = yes
				}
			}
			FROM = {
				owner = {
					save_global_event_target_as = impaled_country
				}
			}
			if = {
				limit = {
					FROM = {
						is_emperor = yes
					}
				}
				country_event = {
					id = wallachian_terror_events.11
				}
			}
			country_event = {
				id = wallachian_terror_events.0
			}
		}
	}
}

on_war_lost = {
	capital_scope = {
		wallachian_terror_remove_severed_command_modifier = yes
		wallachian_terror_remove_leadership_in_exile_modifier = yes
	}
	clr_country_flag = wallachian_terror_captured_hre_emperor
}

on_war_won = {
	capital_scope = {
		wallachian_terror_remove_severed_command_modifier = yes
		wallachian_terror_remove_leadership_in_exile_modifier = yes
	}
	clr_country_flag = wallachian_terror_captured_hre_emperor
}

on_war_ended = {
	capital_scope = {
		wallachian_terror_remove_severed_command_modifier = yes
		wallachian_terror_remove_leadership_in_exile_modifier = yes
	}
	FROM = {
		capital_scope = {
			wallachian_terror_remove_severed_command_modifier = yes
			wallachian_terror_remove_leadership_in_exile_modifier = yes
		}
	}
}

on_siege_won_province = {
	wallachian_terror_remove_severed_command_modifier = yes
	wallachian_terror_remove_leadership_in_exile_modifier = yes
}

on_new_monarch = {
	if = {
		limit = {
			has_ruler_flag = impaler_heir
		}
		add_ruler_personality = impaler_personality
		clr_ruler_flag = impaler_heir
		change_dip = -1
		change_ruler_stat = {
			type = mil
			amount = 1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = zealot_heir
		}
		add_ruler_personality = zealot_personality
	}
	else_if = {
		limit = {
			has_ruler_flag = not_impaler_heir
		}
		clr_ruler_flag = impaler_Heir
	}
}
